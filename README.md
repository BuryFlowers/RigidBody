# RigidBody



## 概述

本项目使用OpenGL实现了简单的刚体动画：每个三角形网格模型的质量均匀分布在每个顶点上，受到重力的同时会与其他三角形网格模型产生碰撞。



## 刚体动画

本项目仅支持OBJ格式的三角形网格，并将物体所受的力全部离散至各个顶点，当只有边相交时不会产生碰撞。每个物体拥有的属性为：质量、位移、旋转（四元数）、线速度与角速度。



每一帧的每个物体的刚体动画算法流程如下：

1.计算外力的合力（一般仅有重力）。
2.碰撞检测：

​		①遍历所有其他物体进行检测。

​		②遍历该物体所有顶点，使用射线法（射线方向为（0,1,0））与被测物体的所有三角形面片进行相交检测，同时记录该顶点与各三角形面片的最近距离（仅记录点在三角形平面内部时的距离）。

​		③若射线的交点数量为奇数，则表示点在物体内部，进行碰撞计算，否则就在物体外部。

​		④点若处于物体内部，则将物体的整体位移减去该点的最近距离乘以最近距离所在面片的法向量，使该点离开被测物体内部。

​		⑤若物体线速度与最近距离所在面片的法向量的点积为负，则代表该物体在下一帧仍有可能进入被测物体内部，故需对该物体施加碰撞以保证该物体不再进入物体内部。

​		⑥由于物体属性中不存储每个顶点的速度向量，故需通过碰撞产生的冲量来计算最终该物体的速度改变量。

​		⑦计算点的线速度与角速度，使用Impulse方法计算碰撞后的新线速度和角速度，通过两者的差计算出物体的整体冲量，再通过冲量算出物体线速度和角速度的改变量。

3.通过物理公式修改物体属性：通过外力和质量计算出加速度更新线速度，使用线速度和角速度更新物体的位移和旋转。



在碰撞检测方面，本人测试了多种方法：

1.最开始仅仅通过判断点是否在所有三角形面片平面内部来判断点是否在物体内部，但该方法仅仅对凸多面体有效。

2.然后通过判断边和三角形是否相交来判断点是否在物体内部，后来被证明这是不可靠的判断方法。

3.最后使用射线法来判断点是否在物体内部，后来发现这种方法对于不封闭的三角形网格是无效的，毕竟对于不封闭的三角形网格来说，没有严格意义上的内外之分。随后由于测试场景中仅有一个垂直于Y轴的二维平面，便将射线方向设为（0,1,0）来让该二维平面上方为外部，下方为内部。



### 优化空间

碰撞检测使用了暴力的枚举法来一一检测相交，实际上可以使用BVH来加速射线的相交检测。

可以加入边边检测来产生边的碰撞。

​	